<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drankspel Party ğŸ‰ğŸ»</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        // Enhanced Supabase availability check with debugging
        window.addEventListener('load', function() {
            setTimeout(() => {
                console.log('ğŸ” Checking Supabase availability...');
                console.log('window.supabase:', typeof window.supabase);
                console.log('window.supabaseClient:', typeof window.supabaseClient);
                
                if (typeof window.supabase === 'undefined') {
                    console.log('âš ï¸ Supabase niet beschikbaar, demo modus');
                    window.supabaseAvailable = false;
                    
                    // Try to load from alternative CDN
                    console.log('ğŸ”„ Trying alternative CDN...');
                    const script = document.createElement('script');
                    script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2';
                    script.onload = function() {
                        console.log('âœ… Supabase geladen via alternatieve CDN');
                        window.supabaseAvailable = true;
                    };
                    script.onerror = function() {
                        console.log('âŒ Alle CDNs gefaald');
                        window.supabaseAvailable = false;
                    };
                    document.head.appendChild(script);
                } else {
                    console.log('âœ… Supabase geladen');
                    window.supabaseAvailable = true;
                }
            }, 500);
        });
    </script>
</head>
<body>
    <!-- Veiligheidsdisclaimer -->
    <div class="safety-disclaimer">
        âš ï¸ Speel verantwoordelijk. Deze app is bedoeld voor volwassenen. Drink met mate.
    </div>

    <!-- Hoofdcontainer -->
    <div id="app" class="app-container">
        
        <!-- Startscherm -->
        <div id="startScreen" class="screen active">
            <div class="screen-content">
                <h1 class="main-title">ğŸ‰ Drankspel Party ğŸ»</h1>
                <p class="subtitle">Speel samen online of lokaal!</p>
                
                <div class="button-group">
                    <button class="btn btn-primary" onclick="showLobbyScreen()">
                        ğŸ  Lobby
                    </button>
                    <button class="btn btn-secondary" onclick="showGameSelection()">
                        ğŸ® Lokaal spelen
                    </button>
                    <button class="btn btn-secondary" onclick="showRules()">
                        ğŸ“– Spelregels bekijken
                    </button>
                    <button class="btn btn-secondary" onclick="showSettings()">
                        âš™ï¸ Instellingen
                    </button>
                </div>
            </div>
        </div>

        <!-- Lobby scherm -->
        <div id="lobbyScreen" class="screen">
            <div class="screen-content">
                <h2>ğŸ  Lobby</h2>
                <button class="btn btn-back" onclick="showStartScreen()">â† Terug</button>
                
                <div class="lobby-tabs">
                    <button class="tab-btn active" onclick="showLobbyTab('create', this)">Nieuwe lobby</button>
                    <button class="tab-btn" onclick="showLobbyTab('join', this)">Join lobby</button>
                    <button class="tab-btn" onclick="showLobbyTab('rooms', this)">Beschikbare rooms</button>
                </div>

                <!-- Nieuwe lobby tab -->
                <div id="createLobbyTab" class="lobby-tab active">
                    <h3>ğŸ†• Nieuwe lobby maken</h3>
                    <div class="lobby-form">
                        <div class="form-group">
                            <label>Jouw naam:</label>
                            <input type="text" id="playerName" placeholder="Voer je naam in" value="Speler">
                        </div>
                        <div class="form-group">
                            <label>Room naam:</label>
                            <input type="text" id="roomName" placeholder="Mijn feest lobby">
                        </div>
                        <div class="form-group">
                            <label>Spel:</label>
                            <select id="selectedGame">
                                <option value="paardenrace">ğŸ‡ Paardenrace</option>
                                <option value="mexico">ğŸ² Mexico</option>
                                <option value="bussen">ğŸƒ Bussen</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Max spelers:</label>
                            <select id="maxPlayers">
                                <option value="4">4 spelers</option>
                                <option value="6">6 spelers</option>
                                <option value="8">8 spelers</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="createLobby()" id="createLobbyBtn">
                            <span class="btn-text">ğŸ  Lobby maken</span>
                            <span class="btn-loading" style="display: none;">â³ Maken...</span>
                        </button>
                    </div>
                </div>

                <!-- Join lobby tab -->
                <div id="joinLobbyTab" class="lobby-tab">
                    <h3>ğŸšª Join lobby</h3>
                    <div class="lobby-form">
                        <div class="form-group">
                            <label>Jouw naam:</label>
                            <input type="text" id="joinPlayerName" placeholder="Voer je naam in" value="Speler">
                        </div>
                        <div class="form-group">
                            <label>Room code:</label>
                            <input type="text" id="roomCode" placeholder="Voer room code in" maxlength="6">
                        </div>
                        <button class="btn btn-primary" onclick="joinLobby()" id="joinLobbyBtn">
                            <span class="btn-text">ğŸšª Join lobby</span>
                            <span class="btn-loading" style="display: none;">â³ Joinen...</span>
                        </button>
                    </div>
                </div>

                <!-- Beschikbare rooms tab -->
                <div id="roomsTab" class="lobby-tab">
                    <h3>ğŸ“‹ Beschikbare rooms</h3>
                    <div id="roomsList" class="rooms-list">
                        <div class="room-item">
                            <div class="room-info">
                                <h4>ğŸ‰ Feest lobby</h4>
                                <p>ğŸ‡ Paardenrace â€¢ 2/4 spelers</p>
                                <p>Room code: ABC123</p>
                            </div>
                            <button class="btn btn-small" onclick="joinRoomByCode('ABC123')">Join</button>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; justify-content: center; margin-top: 15px;">
                        <button class="btn btn-secondary" onclick="refreshRooms()">ğŸ”„ Ververs</button>
                        <button class="btn btn-warning" onclick="forceCleanup()" style="background: #ff6b6b; color: white;">ğŸ’¥ Force Cleanup</button>
                    </div>
                </div>

                <!-- Lobby tabs container -->
                <div id="lobbyTabs">
                    <!-- Tabs content is already above -->
                </div>

                <!-- Lobby status -->
                <div id="lobbyStatus" class="lobby-status" style="display: none;">
                    <h3>ğŸ  In lobby: <span id="currentRoomName"></span></h3>
                    <p>Room code: <strong id="currentRoomCode"></strong></p>
                    <p>Spel: <span id="currentGameType"></span></p>
                    <p id="connectionStatus" class="connection-indicator">ğŸ”„ Verbonden met server</p>
                    
                    <div class="players-section">
                        <h4>ğŸ‘¥ Spelers (<span id="playerCount">0</span>)</h4>
                        <div id="playersList" class="players-list">
                            <!-- Players will be populated here -->
                        </div>
                    </div>
                    
                    <div class="lobby-actions">
                        <button class="btn btn-primary" id="startGameBtn" onclick="startGame()" disabled>
                            ğŸ® Start spel
                        </button>
                        <button class="btn btn-secondary" onclick="leaveLobby()">ğŸšª Verlaat lobby</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Spelkeuze scherm -->
        <div id="gameSelection" class="screen">
            <div class="screen-content">
                <h2>ğŸ® Kies je spel</h2>
                <button class="btn btn-back" onclick="showStartScreen()">â† Terug</button>
                
                <div class="game-grid">
                    <div class="game-card">
                        <div class="game-icon">ğŸ‡</div>
                        <h3>Paardenrace</h3>
                        <p>Wed op paarden en kijk wie als eerste de finish bereikt!</p>
                        <div class="game-actions">
                            <button class="btn btn-primary" onclick="startGame('paardenrace')">
                                Speel
                            </button>
                            <button class="btn btn-secondary" onclick="showGameRules('paardenrace')">
                                Regels
                            </button>
                        </div>
                    </div>

                    <div class="game-card">
                        <div class="game-icon">ğŸ²</div>
                        <h3>Mexico</h3>
                        <p>Gooi dobbelstenen en probeer de hoogste score te krijgen!</p>
                        <div class="game-actions">
                            <button class="btn btn-primary" onclick="startGame('mexico')">
                                Speel
                            </button>
                            <button class="btn btn-secondary" onclick="showGameRules('mexico')">
                                Regels
                            </button>
                        </div>
                    </div>

                    <div class="game-card">
                        <div class="game-icon">ğŸƒ</div>
                        <h3>Bussen</h3>
                        <p>Vraag en antwoord met kaarten, dan de bus!</p>
                        <div class="game-actions">
                            <button class="btn btn-primary" onclick="startGame('bussen')">
                                Speel
                            </button>
                            <button class="btn btn-secondary" onclick="showGameRules('bussen')">
                                Regels
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Instellingen scherm -->
        <div id="settingsScreen" class="screen">
            <div class="screen-content">
                <h2>âš™ï¸ Instellingen</h2>
                <button class="btn btn-back" onclick="showStartScreen()">â† Terug</button>
                
                <div class="settings-section">
                    <h3>ğŸ‘¥ Spelers</h3>
                    <div class="setting-item">
                        <label>Aantal spelers: <span id="playerCountDisplay">4</span></label>
                        <input type="range" id="playerCount" min="2" max="8" value="4" onchange="updatePlayerCount()">
                    </div>
                    <div id="playerNames"></div>
                </div>

                <div class="settings-section">
                    <h3>ğŸº Drink instellingen</h3>
                    <div class="setting-item">
                        <label>Drinkeenheid:</label>
                        <select id="drinkUnit" onchange="saveSettings()">
                            <option value="slokken">Slokken</option>
                            <option value="shots">Shots</option>
                            <option value="anders">Anders</option>
                        </select>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>ğŸ¨ Weergave</h3>
                    <div class="setting-item">
                        <label>Animatie snelheid:</label>
                        <select id="animationSpeed" onchange="saveSettings()">
                            <option value="slow">Langzaam</option>
                            <option value="normal" selected>Standaard</option>
                            <option value="fast">Snel</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="soundEnabled" onchange="saveSettings()">
                            Geluid aan
                        </label>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="saveSettings()">ğŸ’¾ Instellingen opslaan</button>
            </div>
        </div>

        <!-- Spelregels scherm -->
        <div id="rulesScreen" class="screen">
            <div class="screen-content">
                <h2>ğŸ“– Spelregels</h2>
                <button class="btn btn-back" onclick="showStartScreen()">â† Terug</button>
                
                <div class="rules-content">
                    <div class="rule-section">
                        <h3>ğŸ‡ Paardenrace</h3>
                        <ul>
                            <li>6 paarden staan aan de startlijn</li>
                            <li>Elke beurt wordt een dobbelsteen geworpen</li>
                            <li>Het paard met het gegooide nummer schuift 1 stap vooruit</li>
                            <li>Winnaar: mag 1 drankje uitdelen</li>
                            <li>Verliezers: drinken 2 drankjes</li>
                        </ul>
                    </div>

                    <div class="rule-section">
                        <h3>ğŸ² Mexico</h3>
                        <ul>
                            <li>Elke speler gooit twee dobbelstenen</li>
                            <li>Score = grootste cijfer + kleinste cijfer (bijv. 4+2 = 42)</li>
                            <li>21 = Mexico (hoogste score)</li>
                            <li>Laagste score per ronde = drinken</li>
                            <li>Mexico gooien = 2 drankjes uitdelen</li>
                        </ul>
                    </div>

                    <div class="rule-section">
                        <h3>ğŸƒ Bussen</h3>
                        <ul>
                            <li><strong>Fase 1:</strong> Vraag en antwoord met kaarten</li>
                            <li>Rood/zwart, hoger/lager, binnen/buiten, kleur raden</li>
                            <li>Fout = drinken</li>
                            <li><strong>Fase 2:</strong> De bus (piramide van kaarten)</li>
                            <li>Heb je de omgedraaide kaart? Deel drankjes uit!</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scorebord -->
        <div id="scoreboard" class="scoreboard">
            <h3>ğŸ† Scorebord</h3>
            <div id="scoreList"></div>
            <button class="btn btn-small" onclick="resetScores()">ğŸ”„ Reset</button>
        </div>

        <!-- Paardenrace spel -->
        <div id="paardenraceGame" class="screen game-screen">
            <div class="screen-content">
                <h2>ğŸ‡ Paardenrace</h2>
                <button class="btn btn-back" onclick="showGameSelection()">â† Terug</button>
                
                <div class="race-track">
                    <div class="finish-line"></div>
                    <div id="horses" class="horses-container"></div>
                </div>
                
                <div class="game-controls">
                    <button id="rollDice" class="btn btn-primary" onclick="rollDiceForRace()">
                        ğŸ² Gooi dobbelsteen
                    </button>
                    <div id="diceResult" class="dice-result"></div>
                </div>
                
                <div id="raceResults" class="game-results"></div>
            </div>
        </div>

        <!-- Mexico spel -->
        <div id="mexicoGame" class="screen game-screen">
            <div class="screen-content">
                <h2>ğŸ² Mexico</h2>
                <button class="btn btn-back" onclick="showGameSelection()">â† Terug</button>
                
                <div class="current-player">
                    <h3>Huidige speler: <span id="currentPlayerName"></span></h3>
                </div>
                
                <div class="dice-container">
                    <div id="dice1" class="dice">?</div>
                    <div id="dice2" class="dice">?</div>
                </div>
                
                <div class="game-controls">
                    <button id="rollMexico" class="btn btn-primary" onclick="rollDiceForMexico()">
                        ğŸ² Gooi dobbelstenen
                    </button>
                </div>
                
                <div id="mexicoScoreboard" class="scoreboard-mini"></div>
                <div id="mexicoResults" class="game-results"></div>
            </div>
        </div>

        <!-- Bussen spel -->
        <div id="bussenGame" class="screen game-screen">
            <div class="screen-content">
                <h2>ğŸƒ Bussen</h2>
                <button class="btn btn-back" onclick="showGameSelection()">â† Terug</button>
                
                <div class="game-phase">
                    <div class="phase-indicator">
                        <span id="phaseIndicator">Fase 1: Vragen</span>
                    </div>
                </div>
                
                <div id="questionPhase" class="question-phase">
                    <div class="current-card">
                        <div id="currentCard" class="card">?</div>
                    </div>
                    
                    <div class="question-area">
                        <h3 id="questionText">Is de volgende kaart rood of zwart?</h3>
                        <div class="answer-buttons">
                            <button class="btn btn-answer" onclick="answerQuestion('rood')">ğŸ”´ Rood</button>
                            <button class="btn btn-answer" onclick="answerQuestion('zwart')">âš« Zwart</button>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="nextCard()">Volgende kaart</button>
                </div>
                
                <div id="busPhase" class="bus-phase" style="display: none;">
                    <h3>ğŸšŒ De Bus</h3>
                    <div id="busPyramid" class="bus-pyramid"></div>
                    <button class="btn btn-primary" onclick="flipBusCard()">Omkeren</button>
                    <button class="btn btn-secondary" onclick="resetBus()">Nieuwe bus</button>
                </div>
                
                <div id="bussenResults" class="game-results"></div>
            </div>
        </div>

    </div>

    <!-- Confetti effect -->
    <div id="confetti" class="confetti-container"></div>

    <script>
        // Check if Supabase is loaded before initializing
        window.addEventListener('load', function() {
            // Wait a bit for all scripts to load
            setTimeout(() => {
                if (typeof window.supabase === 'undefined') {
                    console.log('âš ï¸ Supabase library niet geladen, demo modus');
                    window.supabaseClient = null;
                }
            }, 100);
        });
    </script>
    <script src="simple_supabase.js"></script>
    <script src="app.js"></script>
    <script src="simple_lobby.js"></script>
</body>
</html>
